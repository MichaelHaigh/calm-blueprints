{"status":{},"contains_secrets":false,"product_version":"2.9.7","spec":{"description":"* [Gitea](https:\/\/@@{Gitea.address}@@:3000)","resources":{"client_attrs":{"8e750ee1-95e6-4a4c-a2d6-f7a03b5f376a":{"y":160,"x":541},"3dde34f6_deployment":{"y":160,"x":541},"a1e90fba-06ce-4735-a1fd-94505043ce7f":{"y":160,"x":541},"3bf520b7-e920-4aaa-8910-eee0a109b127":{"y":160,"x":541},"77cfbb1c-d2d2-4c57-931a-690551d8f27b":{"y":160,"x":541}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"14c8fe8d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f603ab76_runbook","main_task_local_reference":{"kind":"app_task","name":"14c8fe8d_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6268e978_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d738eefe_runbook","main_task_local_reference":{"kind":"app_task","name":"6268e978_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"11f7e9b6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7748f46a_runbook","main_task_local_reference":{"kind":"app_task","name":"11f7e9b6_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"52def80e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"534c563f_runbook","main_task_local_reference":{"kind":"app_task","name":"52def80e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1b587922_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e9d7de80_runbook","main_task_local_reference":{"kind":"app_task","name":"1b587922_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Gitea","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"Gitea_AHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"boot_config":true,"disk_list":{"1":{"disk_size_mib":true},"0":{"device_properties":{"disk_address":{}}},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"7":{"disk_size_mib":true},"6":{"disk_size_mib":true},"8":{"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"gitea-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"0e26c135-d478-428e-9fb8-22c0acfa5f3a"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"4e4f1d3b-9492-4502-9eed-d994192669a4","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"c24ddfdb-31f9-4ff5-a788-3e4be01ff799"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":7,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":8,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS","editables":{"username":true,"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Gitea"}],"name":"Gitea_AHV_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Gitea_AHV_Package"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"1InstallSoftware"},{"kind":"app_task","name":"2DiskSetup"},{"kind":"app_task","name":"3InstallMySQL"},{"kind":"app_task","name":"4SetupMySQL"},{"kind":"app_task","name":"5CreateCerts"},{"kind":"app_task","name":"6ConfGitea"},{"kind":"app_task","name":"7GiteaService"}],"name":"d80995e3_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"1InstallSoftware"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2DiskSetup"}},{"from_task_reference":{"kind":"app_task","name":"2DiskSetup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"3InstallMySQL"}},{"from_task_reference":{"kind":"app_task","name":"3InstallMySQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"4SetupMySQL"}},{"from_task_reference":{"kind":"app_task","name":"4SetupMySQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"5CreateCerts"}},{"from_task_reference":{"kind":"app_task","name":"5CreateCerts"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"6ConfGitea"}},{"from_task_reference":{"kind":"app_task","name":"6ConfGitea"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"7GiteaService"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"1InstallSoftware","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# -*- Install Necessary software\nsudo yum update -y --quiet\nsudo yum install -y  htop wget iotop xfs* bc unzip lvm2* git vim jq python3\nsudo pip3 install -U simplejson\n\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/sysconfig\/selinux\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/selinux\/config\nsudo setenforce 0\n\necho \"System packages are installed\"\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"2DiskSetup","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n##############\n#\n# LVM setup script for MySQL . 4 disks for DATA and 4 for logs\n# Data disks are 50GB | Log disks are 25GB \n#\n#############\n\n\n#PGSQL data\nsudo pvcreate \/dev\/sdb \/dev\/sdc \/dev\/sdd \/dev\/sde\nsudo vgcreate mysqlDataVG \/dev\/sdb \/dev\/sdd \/dev\/sdc \/dev\/sde\nsudo lvcreate -l 100%FREE -i4 -I1M -n mysqlDataLV mysqlDataVG          ## Use 1MB to avoid IO amplification \n#lvcreate -l 100%FREE -i4 -I4M -n pgDataLV pgDataVG\n\n\n#PGSQL logs\nsudo pvcreate \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo vgcreate mysqlLogVG \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo lvcreate -l 100%FREE -i2 -I1M -n mysqlLogLV mysqlLogVG            ## Use 1MB to avoid IO amplification\n#lvcreate -l 100%FREE -i2 -I4M -n pgLogLV pgLogVG\n\n\n#Disable LVM read ahead\nsudo lvchange -r 0 \/dev\/mysqlDataVG\/mysqlDataLV\nsudo lvchange -r 0 \/dev\/mysqlLogVG\/mysqlLogLV\n\n\n#Format LVMs with ext4 and use nodiscard to make sure format time is fast on Nutanix due to SCSI unmap\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlDataVG\/mysqlDataLV\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlLogVG\/mysqlLogLV\n\nsleep 30\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"3InstallMySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo hostnamectl set-hostname \"@@{name}@@\"\n\n# -*- Mysql installation \nsudo yum install -y --quiet \"http:\/\/repo.mysql.com\/mysql80-community-release-el7.rpm\"\nsudo yum update -y --quiet\nsudo yum install -y --quiet sshpass mysql-community-server.x86_64\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4SetupMySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\necho \"!includedir \/etc\/my.cnf.d\" | sudo tee -a \/etc\/my.cnf\n\necho \"[mysqld]\nbinlog-format=mixed\nlog-bin=mysql-bin\ndatadir=\/mysql\/data\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\ninnodb_data_home_dir = \/mysql\/data\ninnodb_log_group_home_dir = \/mysql\/log\ninnodb_file_per_table\ntmpdir=\/mysql\/tmpdir\ninnodb_undo_directory = \/mysql\/undo\ndefault-storage-engine = innodb\ndefault_tmp_storage_engine = innodb\ninnodb_log_files_in_group = 4\ninnodb_log_file_size = 1G\ninnodb_log_buffer_size = 8M\ninnodb_buffer_pool_size = 6G\t\nlarge-pages\t\ninnodb_buffer_pool_instances = 64\t\ninnodb_flush_method=O_DIRECT\t\ninnodb_flush_neighbors=0\t \ninnodb_flush_log_at_trx_commit=1\ninnodb_buffer_pool_dump_at_shutdown=1\t\ninnodb_buffer_pool_load_at_startup=1\t\nbulk_insert_buffer_size = 256\t\ninnodb_thread_concurrency = 16\t\n \t \n# Undo tablespace\t \ninnodb_undo_tablespaces = 5\t\n \t \n# Networking\t \nwait_timeout=57600\t \nmax_allowed_packet=1G\t\nsocket=\/var\/lib\/mysql\/mysql.sock\t \nskip-name-resolve\nport=3306\t\nmax_connections=1000\t\n\n\n[mysqld_safe]\nlog-error=\/mysql\/log\/mysqld.log\npid-file=\/var\/run\/mysqld\/mysqld.pid\" | sudo tee \/etc\/my.cnf.d\/nutanix.cnf\n\nsudo sed -i \"\/\\[mysqld\\]\/a server-id=100\" \/etc\/my.cnf.d\/nutanix.cnf\n\n\n# -*- Sysctl configuration\nmysql_grp_id=`id -g mysql`\nsudo sysctl -w vm.swappiness=0\nsudo sysctl -w vm.nr_hugepages=1024\nsudo sysctl -w vm.overcommit_memory=1\nsudo sysctl -w vm.dirty_background_ratio=5 \nsudo sysctl -w vm.dirty_ratio=15\nsudo sysctl -w vm.dirty_expire_centisecs=500\nsudo sysctl -w vm.dirty_writeback_centisecs=100\nsudo sysctl -w vm.hugetlb_shm_group=$mysql_grp_id\n\necho \"vm.swappiness=0\nvm.nr_hugepages=1024\nvm.overcommit_memory=1\nvm.dirty_background_ratio=5 \nvm.dirty_ratio=15\nvm.dirty_expire_centisecs=500\nvm.dirty_writeback_centisecs=100\nvm.hugetlb_shm_group=$mysql_grp_id\" | sudo tee  -a \/etc\/sysctl.conf\n\necho \"ACTION=='add|change', SUBSYSTEM=='block', RUN+='\/bin\/sh -c \\\"\/bin\/echo 1024 > \/sys%p\/queue\/max_sectors_kb\\\"'\" | sudo tee \/etc\/udev\/rules.d\/71-block-max-sectors.rules\n#echo 1024 | sudo tee \/sys\/block\/sd?\/queue\/max_sectors_kb\n\necho \"\/dev\/mysqlDataVG\/mysqlDataLV \/mysql\/data ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\necho \"\/dev\/mysqlLogVG\/mysqlLogLV \/mysql\/log ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\nsudo mkdir -p \/mysql\/log \/mysql\/data \/mysql\/tmpdir \/mysql\/undo\nsudo mount -a\nsudo chown -R mysql:mysql \/mysql\n\nsudo systemctl enable mysqld\n\nsudo rm -rf \/mysql\/data\/*\nsudo systemctl start mysqld\n\n#Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n\n#Mysql secure installation\nsudo mysql -u root<<-EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nCREATE DATABASE gitea;\nCREATE USER 'gitea'@'localhost' IDENTIFIED BY '@@{GITEA_PASSWORD}@@';\nCREATE USER 'gitea'@'127.0.0.1' IDENTIFIED BY '@@{GITEA_PASSWORD}@@';\nGRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'localhost';\nGRANT ALL PRIVILEGES ON gitea.* TO 'gitea'@'127.0.0.1';\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"5CreateCerts","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Create Certificate Authority\nopenssl genrsa -out ca.key 4096\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n    -subj \"\/C=US\/ST=NC\/L=Durham\/O=example\/OU=Personal\/CN=@@{address}@@\" \\\n    -key ca.key \\\n    -out ca.crt\n\n# Create Private Key and CSR\nopenssl genrsa -out @@{address}@@.key 4096\nopenssl req -sha512 -new \\\n    -subj \"\/C=US\/ST=NC\/L=Durham\/O=example\/OU=Personal\/CN=@@{address}@@\" \\\n    -key @@{address}@@.key \\\n    -out @@{address}@@.csr\n\n# Create Ext Conf file\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth \nsubjectAltName = @alt_names\n\n[alt_names]\nIP.1=@@{address}@@\nDNS.1=localhost\nEOF\n\n# Generate Certificate\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in @@{address}@@.csr \\\n    -out @@{address}@@.crt\n\n# Configure Server Certificate and Key\nsudo cp @@{address}@@.crt \/etc\/pki\/tls\/certs\/localhost.crt\nsudo cp @@{address}@@.key \/etc\/pki\/tls\/private\/localhost.key","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"6ConfGitea","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Add git user\nsudo adduser --system --home \/home\/git git\nsudo mkdir \/home\/git\nsudo chown git:git \/home\/git\n\n# Create dir structure per gitea docs\nsudo mkdir -p \/var\/lib\/gitea\/{custom,data,log}\nsudo chown -R git:git \/var\/lib\/gitea\/\nsudo chmod -R 750 \/var\/lib\/gitea\/\nsudo mkdir \/etc\/gitea\nsudo chown root:git \/etc\/gitea\nsudo chmod 770 \/etc\/gitea\n\n# Get gitea binary and make executable\nwget -O gitea https:\/\/dl.gitea.io\/gitea\/1.10.2\/gitea-1.10.2-linux-amd64\nchmod +x gitea\nsudo cp gitea \/usr\/local\/bin\/gitea\n\n# Create gitea configuration file\necho '[DEFAULT]\nAPP_NAME = Gitea: Nutanix HOLs\n\n[database]\nDB_TYPE  = mysql\nHOST     = 127.0.0.1:3306\nNAME     = gitea\nUSER     = gitea\nPASSWD   = @@{GITEA_PASSWORD}@@\n\n[server]\nPROTOCOL  = https\nROOT_URL  = https:\/\/@@{address}@@:3000\/\nHTTP_PORT = 3000\nCERT_FILE = \/etc\/pki\/tls\/certs\/localhost.crt\nKEY_FILE  = \/etc\/pki\/tls\/private\/localhost.key\n\n[security]\nINSTALL_LOCK = true' | sudo tee -a \/etc\/gitea\/app.ini\nsudo chmod 666 \/etc\/gitea\/app.ini\n\n# Set up DB based on conf file\nsudo su - git -c \"gitea migrate -c \/etc\/gitea\/app.ini\"\nsudo su - git -c \"\/usr\/local\/bin\/gitea admin create-user --admin --username gitadmin  --password '@@{GITEA_PASSWORD}@@' --email noreply@nutanix.com -c \/etc\/gitea\/app.ini\"\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitea"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"7GiteaService","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Create the unit file\necho '[Unit]\nDescription=Gitea (Git with a cup of tea)\nAfter=network.target\nAfter=mysql.service\n\n[Service]\nRestartSec=2s\nType=simple\nUser=git\nGroup=git\nWorkingDirectory=\/var\/lib\/gitea\/\nExecStart=\/usr\/local\/bin\/gitea web -c \/etc\/gitea\/app.ini\nRestart=always\nEnvironment=USER=git HOME=\/home\/git GITEA_WORK_DIR=\/var\/lib\/gitea\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/gitea.service\n\n# Reload daemons and start service\nsudo systemctl daemon-reload\nsudo systemctl start gitea\nsudo systemctl enable gitea\nsudo systemctl status gitea -l","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ecae87f8_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"d80995e3_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Gitea_AHV_Package"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"254e5361_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2ac89dfe_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"254e5361_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","options":{"type":"","name":"CentOS-7-x86_64-1810","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"3dde34f6_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Gitea_AHV_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"Gitea_AHV"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"GITEA_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"Gitea_MySQL"},"api_version":"3.0","metadata":{"last_update_time":"1579798410121657","kind":"blueprint","spec_version":36,"creation_time":"1579631520628839","categories":{"AppFamily":"Databases"},"name":"Gitea_MySQL"}}